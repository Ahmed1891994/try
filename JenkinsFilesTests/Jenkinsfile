pipeline {
    // master executor should be set to 0
    agent any
    stages {
    	stage("Start Pull Latest Image"){
    		steps {
    	     	bat "docker pull ahmedhakem/cucumber-docker:cucumber-docker"
    	    }	
    	}
    	stage("Run Chrome Tests"){
    	     steps {
    	     	bat "docker-compose up -d hub chrome"
    	     	bat "docker-compose up -d testng-chrome"
    	     	bat "docker-compose down chrome testng-chrome"
    	    }
    	}
    	stage("Run Edge Tests"){
    	     steps {
    	     	bat "docker-compose up -d hub edge"
    	     	bat "docker-compose up -d testng-edge"
    	     	bat "docker-compose down edge testng-edge"
    	    }
    	}
    	stage("Run Tests"){
    	     steps {
    	     	bat "docker-compose up -d hub firefox"
    	     	bat "docker-compose up -d testng-firefox"
    	     	bat "docker-compose down firefox testng-firefox"
    	    }
    	}
    }
    post {
        always {
            step([$class: 'Publisher', reportFilenamePattern: 'testng_results/testng-results.xml'])
            bat "docker-compose down"
        }
    }
}